project_metadata:
  name: "Spotlight: Music Networking App"
  version: "1.0.0"
  description: "A centralized mobile platform connecting emerging musicians with event organizers and the general public."
  context: "Major Project Design Report - October 2025"

tech_stack:
  frontend_mobile:
    framework: "React Native"
    target_users: ["Artist", "Organizer", "General Public"]
    state_management: "React Context (Auth)"
    local_storage: "AsyncStorage (Search History)"
  frontend_web:
    framework: "React.js"
    target_users: ["Admin"]
    purpose: "Dashboard for content moderation, contest management, and analytics"
  backend:
    service: "Supabase" # Chosen based on SQL schema requirements
    database: "PostgreSQL"
    auth: "Supabase Auth / Firebase Auth"
    storage: "Supabase Storage / AWS S3" (for Video Portfolios)
    payments: "Razorpay" (for Profile Boosts)
  maps_location:
    service: "Google Maps API / Mapbox" (for Discovery Module)

database_schema:
  enums:
    UserRole: ["artist", "organizer", "public", "admin"]
    BookingStatus: ["pending", "accepted", "rejected", "completed", "cancelled"]
    PaymentStatus: ["pending", "success", "failed"]
    
  tables:
    users:
      description: "Core authentication table"
      columns:
        - { name: "user_id", type: "uuid", pk: true, default: "uuid_generate_v4()" }
        - { name: "email", type: "varchar", unique: true, nullable: false }
        - { name: "role", type: "UserRole", nullable: false }
        - { name: "created_at", type: "timestamp", default: "now()" }

    profiles:
      description: "Extended user details, separated for flexibility"
      columns:
        - { name: "profile_id", type: "uuid", pk: true }
        - { name: "user_id", type: "uuid", fk: "users.user_id", unique: true }
        - { name: "username", type: "varchar", note: "User-chosen unique handle (e.g. maya_rivers)" }
        - { name: "display_name", type: "varchar", nullable: false }
        - { name: "bio", type: "text" }
        - { name: "avatar_url", type: "text", note: "Avatar URL" }
        - { name: "city", type: "varchar", note: "For location filtering" }
        - { name: "latitude", type: "decimal", note: "For proximity search" }
        - { name: "longitude", type: "decimal", note: "For proximity search" }
        - { name: "genres", type: "text[]", note: "Array of strings (e.g., Jazz, Rock)" }
        - { name: "instruments", type: "text[]", note: "Array of strings" }
        - { name: "is_boosted", type: "boolean", default: false, note: "Monetization feature" }
        - { name: "boost_expiry", type: "timestamp" }

    videos:
      description: "Artist portfolio content (Reels-style)"
      columns:
        - { name: "video_id", type: "uuid", pk: true }
        - { name: "artist_id", type: "uuid", fk: "profiles.user_id" }
        - { name: "video_url", type: "text", nullable: false, note: "Cloud storage link" }
        - { name: "thumbnail_url", type: "text" }
        - { name: "tags", type: "text[]", note: "For discovery algorithm" }
        - { name: "views_count", type: "integer", default: 0 }
        - { name: "likes_count", type: "integer", default: 0 }
        - { name: "upload_date", type: "timestamp", default: "now()" }

    events:
      description: "Public live events created by Organizers, subject to Admin approval before listing"
      columns:
        - { name: "event_id", type: "uuid", pk: true }
        - { name: "organizer_id", type: "uuid", fk: "users.user_id" }
        - { name: "title", type: "varchar", nullable: false }
        - { name: "description", type: "text" }
        - { name: "poster_url", type: "text" }
        - { name: "event_date", type: "timestamp", nullable: false }
        - { name: "location_name", type: "varchar" }
        - { name: "location_coords", type: "point" }
        - { name: "city", type: "varchar", note: "Used for fast filtering by location" }
        - { name: "ticket_links", type: "text", note: "Optional external ticketing links (legacy support)" }
        - { name: "ticket_price", type: "decimal" }
        - { name: "total_tickets", type: "integer" }
        - { name: "available_tickets", type: "integer" }
        - { name: "approval_status", type: "varchar", default: "pending", note: "pending, approved, rejected" }
        - { name: "is_deleted", type: "boolean", default: false }
        - { name: "created_at", type: "timestamp", default: "now()" }

    bookings:
      description: "Organizer requests Artist for a gig; private until accepted"
      columns:
        - { name: "booking_id", type: "uuid", pk: true, default: "gen_random_uuid()" }
        - { name: "organizer_id", type: "uuid", fk: "users.user_id" }
        - { name: "artist_id", type: "uuid", fk: "users.user_id" }
        - { name: "event_date", type: "timestamptz", nullable: false }
        - { name: "status", type: "BookingStatus", default: "pending" }
        - { name: "price", type: "decimal" }
        - { name: "message", type: "text" }
        - { name: "created_at", type: "timestamptz", default: "now()" }

    availability:
      description: "Dates when Artist is unavailable (blocked)"
      columns:
        - { name: "availability_id", type: "uuid", pk: true, default: "gen_random_uuid()" }
        - { name: "artist_id", type: "uuid", fk: "users.user_id" }
        - { name: "unavailable_date", type: "date", nullable: false }
        - { name: "created_at", type: "timestamptz", default: "now()" }
      constraints:
        - "UNIQUE(artist_id, unavailable_date)"

    artist_schedule:
      description: "Manual work entries (gigs added by artist, e.g. outside the app)"
      columns:
        - { name: "schedule_id", type: "uuid", pk: true, default: "gen_random_uuid()" }
        - { name: "artist_id", type: "uuid", fk: "users.user_id" }
        - { name: "schedule_date", type: "date", nullable: false }
        - { name: "title", type: "varchar(255)", nullable: false }
        - { name: "notes", type: "text" }
        - { name: "start_time", type: "time", note: "Optional; for schedule entries with specific time" }
        - { name: "duration_minutes", type: "integer", note: "Optional; event length in minutes" }
        - { name: "venue", type: "varchar(255)", note: "Venue or location name" }
        - { name: "location_address", type: "text", note: "Full address if needed" }
        - { name: "created_at", type: "timestamptz", default: "now()" }

    contests:
      description: "Admin-managed competitions"
      columns:
        - { name: "contest_id", type: "uuid", pk: true }
        - { name: "title", type: "varchar" }
        - { name: "start_date", type: "timestamp" }
        - { name: "end_date", type: "timestamp" }
        - { name: "is_active", type: "boolean", default: true }

    contest_submissions:
      description: "Link between Artist Videos and Contests"
      columns:
        - { name: "submission_id", type: "uuid", pk: true }
        - { name: "contest_id", type: "uuid", fk: "contests.contest_id" }
        - { name: "artist_id", type: "uuid", fk: "users.user_id" }
        - { name: "video_id", type: "uuid", fk: "videos.video_id" }
        - { name: "is_winner", type: "boolean", default: false }

    payments:
      description: "Transaction records for Profile Boosts"
      columns:
        - { name: "payment_id", type: "uuid", pk: true }
        - { name: "user_id", type: "uuid", fk: "users.user_id" }
        - { name: "amount", type: "decimal" }
        - { name: "transaction_ref", type: "varchar", note: "Razorpay ID" }
        - { name: "status", type: "PaymentStatus" }
    tickets:
      description: "Public ticket bookings made by users for approved events"
      columns:
        - { name: "ticket_id", type: "uuid", pk: true }
        - { name: "user_id", type: "uuid", fk: "users.user_id", nullable: false }
        - { name: "event_id", type: "uuid", fk: "events.event_id", nullable: false }
        - { name: "quantity", type: "integer", nullable: false }
        - { name: "total_amount", type: "decimal", nullable: false }
        - { name: "booked_at", type: "timestamp", default: "now()" }

modules:
  auth_module:
    functionality: "Login, Registration, Role Assignment"
    inputs: ["Email", "Password", "Role Selection"]
  
  profile_module:
    functionality: "Manage bio, upload avatar, set location"
    logic: "Artists define Genres/Instruments. Organizers define Company/Venue info."

  discovery_module:
    functionality: "Search for artists, View Recent Searches"
    filters: ["Location (Proximity)", "Genre", "Instrument", "Availability", "Text Search (Username/Display Name)"]
    logic: "Supabase 'ilike' query on profiles. Recent searches cached locally via AsyncStorage, scoped to authenticated user_id."

  video_feed_module:
    functionality: "TikTok/Reels style vertical swipe"
    data_source: "Query 'videos' table with inner join on 'profiles' (FK: videos.artist_id -> profiles.user_id)"
    implementation: "Uses expo-video for playback (migrated from expo-av)"

  booking_calendar_module:
    functionality: "Request gigs, Manage Schedule"
    conflict_check: "Check 'bookings', 'availability', and 'artist_schedule' tables before allowing a request."
    tables:
      - "bookings: Organizerâ†’Artist gig requests"
      - "availability: Artist blocked/unavailable dates"
      - "artist_schedule: Artist manual work entries (time, duration, venue)"

  contest_module:
    functionality: "Admin creates contests, Artists submit existing portfolio videos."

  payments_module:
    functionality: "Monetization via Profile Boosts"
    integration: "Razorpay"
    post_success_action: "Update 'profiles.is_boosted' = true"
  ticket_booking_module:
    functionality: "Allow users to book tickets for approved events"
    accessible_to: ["public", "artist", "organizer"]
    logic:
      - "Check event availability"
      - "Insert booking record into tickets table"
      - "Decrement available_tickets in events table"
      - "Update availability status dynamically"
    constraints:
      - "Booking not allowed if event is sold out"

api_endpoints_structure:
  auth:
    - POST /auth/signup
    - POST /auth/login
  discovery:
    - GET /artists?genre=Jazz&city=Kochi
    - GET /artists/nearby?lat=...&long=...
  bookings:
    - POST /bookings/request
    - PATCH /bookings/{id}/status (Accept/Reject)
  portfolio:
    - POST /videos/upload
    - GET /videos/feed
  admin:
    - POST /contests/create
    - GET /analytics/usage